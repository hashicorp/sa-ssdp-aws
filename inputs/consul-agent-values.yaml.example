global:
  enabled: false
  name: consul-eks
  datacenter: us-west-2 #${region}
  image: "hashicorp/consul-enterprise:1.12.8-ent"
  imageEnvoy: "envoyproxy/envoy:v1.22.5"
  enableConsulNamespaces: true
  adminPartitions:
    enabled: true
    name: "us-west-2-eks"
  acls:
    manageSystemACLs: true
    bootstrapToken:
      secretName: consul/data/secret/initial_management 
      secretKey: key # bootstrapToken
    partitionToken: # https://www.consul.io/docs/k8s/deployment-configurations/vault/systems-integration
      secretName: consul/data/secret/partition_token
      secretKey: key
  tls:
    enabled: true
    enableAutoEncrypt: true
    caCert:
      secretName: pki/cert/ca
      secretKey: certificate
#    verify: false
#    serverAdditionalDNSSANs: ["ip-10-0-103-182.us-west-2.compute.internal", "ip-10-0-102-95.us-west-2.compute.internal", "ip-10-0-101-81.us-west-2.compute.internal"]
  gossipEncryption:
    secretName: consul/data/secret/gossip 
    secretKey: key 
#  metrics:
#    enabled: true
  secretsBackend:
    vault:
      enabled: true
      ca:
        secretName: vault-ca ## KubeSecret for Vault CA
        secretKey: key
      consulServerRole: consul-eks-server
      consulClientRole: consul-eks-client
      consulCARole: consul-connect-ca
      manageSystemACLsRole: consul-eks-server-acl-init
      adminPartitionsRole: consul-eks-partition-init
#      agentAnnotations: |
#        "vault.hashicorp.com/namespace": "admin"
      connectCA:
       address: https://sa-vault-lb-28a1758cd2254f3f.elb.us-west-2.amazonaws.com:8200
       rootPKIPath: /connect-root
       intermediatePKIPath: /connect-intermediate
       additionalConfig: |
        {
          "connect": [{
            "ca_config": [{
              "leaf_cert_ttl": "72h",
              "intermediate_cert_ttl": "8760h",
              "rotation_period": "2160h",
              "namespace": "admin"
            }]
          }]
        }

externalServers:
  enabled: true
  hosts: ["ip-10-0-103-113.us-west-2.compute.internal"]
#  - "provider=aws tag_key=sa-consul tag_value=server"
#  httpsPort: 443
  useSystemRoots: false
  k8sAuthMethodHost: https://ED662AA91ABE3D8C5EB5B95239D6807F.gr7.us-west-2.eks.amazonaws.com:443

server:
  enabled: false

client:
  enabled: true
  join: 
  - "provider=aws tag_key=sa-consul tag_value=server"
#  nodeMeta:
#    terraform-module: "hcp-eks-client"

connectInject:
  transparentProxy:
    defaultEnabled: true
  enabled: true
  default: true
#  metrics:
#    defaultEnableMerging: true

controller:
  enabled: true

ingressGateways:
  enabled: true
  gateways:
    - name: ingress-gateway
      service:
        type: LoadBalancer
        ports:
        - port: 80

dns:
  enabled: true
  enableRedirection: true

